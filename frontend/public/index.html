<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distributed Real-Time Chat Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --dark-color: #1C1C1E;
            --light-color: #F2F2F7;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --danger-color: #FF3B30;
            --gray-color: #8E8E93;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        body {
            background-color: #F2F2F7;
            color: #1C1C1E;
            display: flex;
            min-height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            height: 100vh;
            box-shadow: var(--shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 360px;
            background-color: white;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #E5E5EA;
        }

        .user-profile {
            padding: 24px 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #E5E5EA;
            background-color: white;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
            margin-right: 15px;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-status {
            font-size: 14px;
            color: var(--success-color);
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success-color);
            margin-right: 6px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .search-container {
            padding: 20px;
            border-bottom: 1px solid #E5E5EA;
        }

        .search-box {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid #E5E5EA;
            background-color: #F2F2F7;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            border-color: var(--primary-color);
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #F2F2F7;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .chat-item:hover {
            background-color: #F2F2F7;
        }

        .chat-item.active {
            background-color: #E8F4FF;
        }

        .chat-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            margin-right: 15px;
        }

        .chat-info {
            flex: 1;
        }

        .chat-info h4 {
            font-size: 16px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .chat-last-message {
            font-size: 14px;
            color: var(--gray-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .chat-time {
            font-size: 12px;
            color: var(--gray-color);
        }

        .unread-badge {
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .chat-typing {
            color: var(--primary-color);
            font-style: italic;
        }

        /* Main Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: white;
        }

        .chat-header {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #E5E5EA;
            background-color: white;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
        }

        .chat-header-info h3 {
            font-size: 18px;
            margin-right: 10px;
        }

        .chat-participants {
            font-size: 14px;
            color: var(--gray-color);
        }

        .chat-actions {
            display: flex;
            gap: 20px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
            transition: color 0.2s;
        }

        .chat-action-btn:hover {
            color: var(--primary-color);
        }

        .messages-container {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background-color: #F2F2F7;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 70%;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .message.received {
            align-self: flex-start;
        }

        .message.sent {
            align-self: flex-end;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        .message.received .message-bubble {
            background-color: white;
            border-bottom-left-radius: 4px;
            box-shadow: var(--shadow);
        }

        .message.sent .message-bubble {
            background-color: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-sender {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--dark-color);
        }

        .message-time {
            font-size: 11px;
            color: var(--gray-color);
            margin-top: 5px;
            text-align: right;
        }

        .message-status {
            display: inline-block;
            margin-left: 5px;
        }

        .message-typing-indicator {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background-color: white;
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--gray-color);
            margin: 0 2px;
            animation: typingAnimation 1.5s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .message-input-container {
            padding: 20px 24px;
            display: flex;
            align-items: center;
            border-top: 1px solid #E5E5EA;
            background-color: white;
        }

        .input-actions {
            display: flex;
            gap: 15px;
            margin-right: 15px;
        }

        .input-action-btn {
            background: none;
            border: none;
            font-size: 22px;
            color: var(--gray-color);
            cursor: pointer;
            transition: color 0.2s;
        }

        .input-action-btn:hover {
            color: var(--primary-color);
        }

        .message-input {
            flex: 1;
            padding: 14px 18px;
            border-radius: 20px;
            border: 1px solid #E5E5EA;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
            resize: none;
            max-height: 120px;
        }

        .message-input:focus {
            border-color: var(--primary-color);
        }

        .send-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-left: 15px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .send-btn:hover {
            background-color: #0056CC;
        }

        /* Online users panel */
        .online-users {
            width: 280px;
            background-color: white;
            border-left: 1px solid #E5E5EA;
            padding: 20px;
            overflow-y: auto;
        }

        .online-users h3 {
            font-size: 16px;
            margin-bottom: 20px;
            color: var(--dark-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-count {
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .online-user {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .online-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--warning-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 12px;
        }

        .online-user-info h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .online-user-info p {
            font-size: 13px;
            color: var(--gray-color);
        }

        /* System metrics */
        .system-metrics {
            background-color: var(--dark-color);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .system-metrics h4 {
            font-size: 14px;
            margin-bottom: 10px;
            color: #AEAEB2;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .metric-value {
            color: var(--success-color);
            font-weight: 600;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .online-users {
                display: none;
            }
            
            .sidebar {
                width: 300px;
            }
        }

        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .sidebar {
                width: 100%;
                display: none;
            }
            
            .sidebar.active {
                display: flex;
            }
            
            .chat-area {
                width: 100%;
            }
            
            .message {
                max-width: 85%;
            }
            
            .mobile-menu-btn {
                display: block;
                background: none;
                border: none;
                font-size: 24px;
                color: var(--primary-color);
                cursor: pointer;
                margin-right: 15px;
            }
        }

        /* Empty state */
        .empty-chat {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--gray-color);
            text-align: center;
            padding: 40px;
        }

        .empty-chat-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #D1D1D6;
        }

        .empty-chat h3 {
            font-size: 22px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        /* File sharing preview */
        .file-preview {
            background-color: #F2F2F7;
            border-radius: 10px;
            padding: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
        }

        .file-icon {
            font-size: 24px;
            margin-right: 12px;
            color: var(--primary-color);
        }

        .file-info h5 {
            font-size: 14px;
            margin-bottom: 4px;
        }

        .file-info p {
            font-size: 12px;
            color: var(--gray-color);
        }

        /* Read receipts */
        .read-receipts {
            display: flex;
            margin-top: 5px;
            justify-content: flex-end;
        }

        .read-avatar {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-left: -5px;
            border: 2px solid white;
            background-color: var(--success-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar with chats list -->
        <div class="sidebar active" id="sidebar">
            <div class="user-profile">
                <div class="avatar" id="current-user-avatar">JD</div>
                <div class="user-info">
                    <h3 id="current-user-name">John Doe</h3>
                    <div class="user-status">
                        <div class="status-indicator"></div>
                        <span id="current-user-status">Online</span>
                    </div>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-box" placeholder="Search conversations..." id="search-input">
            </div>
            
            <div class="chats-list" id="chats-list">
                <!-- Chat items will be dynamically added here -->
            </div>
        </div>
        
        <!-- Main chat area -->
        <div class="chat-area" id="chat-area">
            <div class="chat-header">
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="chat-header-info">
                    <h3 id="active-chat-name">Jane Smith</h3>
                    <div class="chat-participants" id="active-chat-participants">3 participants</div>
                </div>
                
                <div class="chat-actions">
                    <button class="chat-action-btn" id="video-call-btn" title="Video call">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="chat-action-btn" id="audio-call-btn" title="Audio call">
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="chat-action-btn" id="chat-info-btn" title="Chat info">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>
            
            <div class="messages-container" id="messages-container">
                <!-- Messages will be dynamically added here -->
                
                <div class="message-typing-indicator" id="typing-indicator" style="display: none;">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <span style="margin-left: 10px; font-size: 14px;">Jane is typing...</span>
                </div>
            </div>
            
            <div class="message-input-container">
                <div class="input-actions">
                    <button class="input-action-btn" id="attach-btn" title="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="input-action-btn" id="emoji-btn" title="Emoji">
                        <i class="far fa-smile"></i>
                    </button>
                </div>
                
                <textarea class="message-input" id="message-input" placeholder="Type a message..." rows="1"></textarea>
                
                <button class="send-btn" id="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <!-- Online users panel -->
        <div class="online-users" id="online-users">
            <h3>Online Users <span class="user-count" id="online-count">8</span></h3>
            
            <div id="online-users-list">
                <!-- Online users will be dynamically added here -->
            </div>
            
            <div class="system-metrics">
                <h4>System Performance</h4>
                <div class="metric">
                    <span>Active Connections:</span>
                    <span class="metric-value" id="connections-count">10,247</span>
                </div>
                <div class="metric">
                    <span>Message Latency:</span>
                    <span class="metric-value" id="message-latency">42ms</span>
                </div>
                <div class="metric">
                    <span>Server Load:</span>
                    <span class="metric-value" id="server-load">24%</span>
                </div>
                <div class="metric">
                    <span>Database Shard:</span>
                    <span class="metric-value" id="database-shard">#3</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for demonstration
        const users = [
            { id: 1, name: "Jane Smith", avatar: "JS", status: "online", lastSeen: "2 min ago" },
            { id: 2, name: "Alex Johnson", avatar: "AJ", status: "online", lastSeen: "Just now" },
            { id: 3, name: "Sarah Miller", avatar: "SM", status: "offline", lastSeen: "1 hour ago" },
            { id: 4, name: "Robert Chen", avatar: "RC", status: "online", lastSeen: "5 min ago" },
            { id: 5, name: "Team Alpha", avatar: "TA", status: "group", participants: 8 },
            { id: 6, name: "Emily Davis", avatar: "ED", status: "offline", lastSeen: "Yesterday" },
            { id: 7, name: "Mike Wilson", avatar: "MW", status: "online", lastSeen: "10 min ago" },
            { id: 8, name: "Design Team", avatar: "DT", status: "group", participants: 12 }
        ];

        const messages = {
            1: [
                { id: 1, sender: "Jane Smith", senderId: 1, content: "Hey there! How's the distributed chat system coming along?", time: "09:30 AM", status: "read" },
                { id: 2, sender: "You", senderId: 0, content: "Going well! Just implemented the Redis Pub/Sub for cross-server communication", time: "09:32 AM", status: "read" },
                { id: 3, sender: "Jane Smith", senderId: 1, content: "That's impressive! How are you handling message deduplication?", time: "09:33 AM", status: "read" },
                { id: 4, sender: "You", senderId: 0, content: "Using unique message IDs with a Redis cache to track delivered messages", time: "09:35 AM", status: "read" },
                { id: 5, sender: "You", senderId: 0, content: "Also implemented exponential backoff for reconnection logic", time: "09:35 AM", status: "delivered" },
                { id: 6, sender: "Jane Smith", senderId: 1, content: "Perfect! Those are exactly the kind of scalability features FAANG interviews look for", time: "09:36 AM", status: "read" }
            ],
            5: [
                { id: 1, sender: "Alex Johnson", senderId: 2, content: "Team, we need to discuss the load testing results", time: "Yesterday", status: "read" },
                { id: 2, sender: "Sarah Miller", senderId: 3, content: "I'll share the performance metrics dashboard", time: "Yesterday", status: "read" },
                { id: 3, sender: "You", senderId: 0, content: "Our system handled 10,000 concurrent connections with <100ms latency at the 99th percentile", time: "Yesterday", status: "read" },
                { id: 4, sender: "Robert Chen", senderId: 4, content: "That's amazing! The horizontal scaling design is working perfectly", time: "10:15 AM", status: "read" },
                { id: 5, sender: "Alex Johnson", senderId: 2, content: "Let's schedule a demo for the stakeholders", time: "10:20 AM", status: "read" }
            ],
            8: [
                { id: 1, sender: "Emily Davis", senderId: 6, content: "Has anyone reviewed the new UI designs for the chat interface?", time: "11:30 AM", status: "read" },
                { id: 2, sender: "Mike Wilson", senderId: 7, content: "Yes, they look great! The real-time indicators are very clear", time: "11:45 AM", status: "read" },
                { id: 3, sender: "You", senderId: 0, content: "I've implemented typing indicators and read receipts. Also working on file sharing previews", time: "12:00 PM", status: "read" },
                { id: 4, sender: "Emily Davis", senderId: 6, content: "Can you add end-to-end encryption? That would be a killer feature", time: "12:05 PM", status: "read" },
                { id: 5, sender: "You", senderId: 0, content: "Already implemented! Using a double ratchet algorithm similar to Signal", time: "12:10 PM", status: "read" }
            ]
        };

        // Current state
        let currentUser = { id: 0, name: "John Doe", avatar: "JD", status: "online" };
        let activeChatId = 1;
        let typingTimeout = null;

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const chatsList = document.getElementById('chats-list');
        const messagesContainer = document.getElementById('messages-container');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const activeChatName = document.getElementById('active-chat-name');
        const activeChatParticipants = document.getElementById('active-chat-participants');
        const onlineUsersList = document.getElementById('online-users-list');
        const searchInput = document.getElementById('search-input');

        // Initialize the application
        function init() {
            renderChatsList();
            renderMessages(activeChatId);
            renderOnlineUsers();
            setupEventListeners();
            updateCurrentUserInfo();
            
            // Simulate real-time updates
            simulateRealTimeFeatures();
        }

        // Render the chats list
        function renderChatsList(filter = '') {
            chatsList.innerHTML = '';
            
            users.forEach(user => {
                if (filter && !user.name.toLowerCase().includes(filter.toLowerCase())) {
                    return;
                }
                
                const lastMessage = messages[user.id] ? messages[user.id][messages[user.id].length - 1] : null;
                const isActive = user.id === activeChatId;
                const unreadCount = user.id === 1 ? 0 : Math.floor(Math.random() * 5); // Simulate unread messages
                
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${isActive ? 'active' : ''}`;
                chatItem.dataset.id = user.id;
                
                chatItem.innerHTML = `
                    <div class="chat-avatar" style="background-color: ${getAvatarColor(user.avatar)}">${user.avatar}</div>
                    <div class="chat-info">
                        <h4>
                            ${user.name}
                            <span class="chat-time">${lastMessage ? lastMessage.time : ''}</span>
                        </h4>
                        <div class="chat-last-message">
                            ${lastMessage ? 
                                (lastMessage.senderId === 0 ? 'You: ' : '') + lastMessage.content.substring(0, 30) + (lastMessage.content.length > 30 ? '...' : '') 
                                : 'No messages yet'}
                            ${user.id === 1 && isActive ? '<span class="chat-typing"> is typing...</span>' : ''}
                        </div>
                    </div>
                    ${unreadCount > 0 ? `<div class="unread-badge">${unreadCount}</div>` : ''}
                `;
                
                chatItem.addEventListener('click', () => switchChat(user.id));
                chatsList.appendChild(chatItem);
            });
        }

        // Render messages for a specific chat
        function renderMessages(chatId) {
            messagesContainer.innerHTML = '';
            
            const chatMessages = messages[chatId] || [];
            const activeChat = users.find(u => u.id === chatId);
            
            // Update active chat info
            activeChatName.textContent = activeChat.name;
            activeChatParticipants.textContent = activeChat.participants ? 
                `${activeChat.participants} participants` : 
                activeChat.status === 'online' ? 'Online' : `Last seen ${activeChat.lastSeen}`;
            
            if (chatMessages.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-chat';
                emptyState.innerHTML = `
                    <div class="empty-chat-icon">
                        <i class="far fa-comments"></i>
                    </div>
                    <h3>No messages yet</h3>
                    <p>Start a conversation with ${activeChat.name}</p>
                `;
                messagesContainer.appendChild(emptyState);
                return;
            }
            
            chatMessages.forEach(message => {
                const isSent = message.senderId === 0;
                const messageElement = document.createElement('div');
                messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
                
                // Check if message has file attachment
                const hasFile = message.content.includes('[FILE]');
                let messageContent = message.content;
                let filePreview = '';
                
                if (hasFile) {
                    const fileName = message.content.replace('[FILE] ', '');
                    const fileExt = fileName.split('.').pop().toLowerCase();
                    const fileType = getFileType(fileExt);
                    
                    filePreview = `
                        <div class="file-preview">
                            <div class="file-icon">
                                <i class="fas fa-${fileType.icon}"></i>
                            </div>
                            <div class="file-info">
                                <h5>${fileName}</h5>
                                <p>${fileType.type} â€¢ ${formatFileSize(Math.floor(Math.random() * 5000000) + 100000)}</p>
                            </div>
                        </div>
                    `;
                    messageContent = '';
                }
                
                messageElement.innerHTML = `
                    ${!isSent ? `<div class="message-sender">${message.sender}</div>` : ''}
                    <div class="message-bubble">
                        ${messageContent}
                        ${filePreview}
                    </div>
                    <div class="message-time">
                        ${message.time}
                        ${isSent ? `<span class="message-status">${getStatusIcon(message.status)}</span>` : ''}
                    </div>
                    ${isSent && message.status === 'read' ? `
                        <div class="read-receipts">
                            <div class="read-avatar" style="background-color: ${getAvatarColor('JS')}">J</div>
                            <div class="read-avatar" style="background-color: ${getAvatarColor('AJ')}">A</div>
                        </div>
                    ` : ''}
                `;
                
                messagesContainer.appendChild(messageElement);
            });
            
            // Scroll to the bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Show typing indicator for Jane Smith if it's the active chat
            if (chatId === 1) {
                setTimeout(() => {
                    typingIndicator.style.display = 'flex';
                }, 1000);
            } else {
                typingIndicator.style.display = 'none';
            }
        }

        // Render online users panel
        function renderOnlineUsers() {
            onlineUsersList.innerHTML = '';
            
            const onlineUsers = users.filter(user => user.status === 'online' && user.id !== 0);
            
            onlineUsers.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'online-user';
                userElement.innerHTML = `
                    <div class="online-user-avatar" style="background-color: ${getAvatarColor(user.avatar)}">
                        ${user.avatar}
                    </div>
                    <div class="online-user-info">
                        <h4>${user.name}</h4>
                        <p>Connected to Server #${Math.floor(Math.random() * 4) + 1}</p>
                    </div>
                `;
                onlineUsersList.appendChild(userElement);
            });
            
            // Update online count
            document.getElementById('online-count').textContent = onlineUsers.length;
        }

        // Switch to a different chat
        function switchChat(chatId) {
            activeChatId = chatId;
            renderChatsList();
            renderMessages(chatId);
            
            // Hide typing indicator when switching chats
            if (chatId !== 1) {
                typingIndicator.style.display = 'none';
            }
            
            // Close mobile sidebar on mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('active');
            }
        }

        // Send a new message
        function sendMessage() {
            const content = messageInput.value.trim();
            if (!content) return;
            
            const newMessage = {
                id: messages[activeChatId] ? messages[activeChatId].length + 1 : 1,
                sender: "You",
                senderId: 0,
                content: content,
                time: getCurrentTime(),
                status: 'sent'
            };
            
            if (!messages[activeChatId]) {
                messages[activeChatId] = [];
            }
            
            messages[activeChatId].push(newMessage);
            renderMessages(activeChatId);
            messageInput.value = '';
            adjustTextareaHeight();
            
            // Simulate reply for Jane Smith (chat ID 1)
            if (activeChatId === 1) {
                setTimeout(() => {
                    simulateReply();
                }, 1000);
            }
            
            // Update last message in chats list
            renderChatsList(searchInput.value);
        }

        // Simulate a reply from the other person
        function simulateReply() {
            const replies = [
                "That sounds like a solid implementation!",
                "How are you handling database sharding?",
                "The monitoring dashboard looks great with those real-time metrics",
                "Have you considered adding end-to-end encryption?",
                "What's your strategy for handling server failures?",
                "The load balancing setup seems robust"
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            
            const replyMessage = {
                id: messages[activeChatId].length + 1,
                sender: "Jane Smith",
                senderId: 1,
                content: randomReply,
                time: getCurrentTime(),
                status: 'read'
            };
            
            messages[activeChatId].push(replyMessage);
            renderMessages(activeChatId);
            renderChatsList(searchInput.value);
        }

        // Simulate typing indicator
        function simulateTyping() {
            if (activeChatId === 1) {
                typingIndicator.style.display = 'flex';
                
                // Hide after 3 seconds
                clearTimeout(typingTimeout);
                typingTimeout = setTimeout(() => {
                    typingIndicator.style.display = 'none';
                }, 3000);
            }
        }

        // Simulate real-time features
        function simulateRealTimeFeatures() {
            // Randomly update system metrics
            setInterval(() => {
                const connections = Math.floor(Math.random() * 2000) + 9000;
                const latency = Math.floor(Math.random() * 30) + 20;
                const load = Math.floor(Math.random() * 30) + 15;
                const shard = Math.floor(Math.random() * 8) + 1;
                
                document.getElementById('connections-count').textContent = connections.toLocaleString();
                document.getElementById('message-latency').textContent = `${latency}ms`;
                document.getElementById('server-load').textContent = `${load}%`;
                document.getElementById('database-shard').textContent = `#${shard}`;
            }, 5000);
            
            // Randomly update user statuses
            setInterval(() => {
                const randomUserIndex = Math.floor(Math.random() * users.length);
                if (users[randomUserIndex].status === 'online') {
                    users[randomUserIndex].status = 'offline';
                    users[randomUserIndex].lastSeen = 'Just now';
                } else {
                    users[randomUserIndex].status = 'online';
                }
                
                renderOnlineUsers();
                renderChatsList(searchInput.value);
            }, 15000);
            
            // Simulate receiving messages in group chats
            setInterval(() => {
                if (activeChatId !== 1 && Math.random() > 0.7) {
                    const groupUsers = users.filter(u => u.id === 5 || u.id === 8);
                    const randomGroup = groupUsers[Math.floor(Math.random() * groupUsers.length)];
                    
                    const groupMessages = [
                        "The load testing results are ready",
                        "Can someone review my PR?",
                        "We need to discuss the scaling strategy",
                        "The Redis cluster configuration is complete",
                        "I've added monitoring for message delivery rates"
                    ];
                    
                    const randomMessage = groupMessages[Math.floor(Math.random() * groupMessages.length)];
                    const randomUser = users[Math.floor(Math.random() * 4) + 1];
                    
                    const newMessage = {
                        id: messages[randomGroup.id] ? messages[randomGroup.id].length + 1 : 1,
                        sender: randomUser.name,
                        senderId: randomUser.id,
                        content: randomMessage,
                        time: getCurrentTime(),
                        status: 'read'
                    };
                    
                    if (!messages[randomGroup.id]) {
                        messages[randomGroup.id] = [];
                    }
                    
                    messages[randomGroup.id].push(newMessage);
                    
                    // Only re-render if this is the active chat
                    if (activeChatId === randomGroup.id) {
                        renderMessages(activeChatId);
                    }
                    
                    renderChatsList(searchInput.value);
                }
            }, 10000);
        }

        // Set up event listeners
        function setupEventListeners() {
            sendBtn.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            messageInput.addEventListener('input', () => {
                adjustTextareaHeight();
                simulateTyping();
            });
            
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
            });
            
            // Attach file button
            document.getElementById('attach-btn').addEventListener('click', () => {
                const fileTypes = ['design.pdf', 'performance_report.xlsx', 'architecture.png', 'code_sample.js'];
                const randomFile = fileTypes[Math.floor(Math.random() * fileTypes.length)];
                
                const newMessage = {
                    id: messages[activeChatId] ? messages[activeChatId].length + 1 : 1,
                    sender: "You",
                    senderId: 0,
                    content: `[FILE] ${randomFile}`,
                    time: getCurrentTime(),
                    status: 'sent'
                };
                
                if (!messages[activeChatId]) {
                    messages[activeChatId] = [];
                }
                
                messages[activeChatId].push(newMessage);
                renderMessages(activeChatId);
                renderChatsList(searchInput.value);
            });
            
            // Emoji button
            document.getElementById('emoji-btn').addEventListener('click', () => {
                const emojis = ['ðŸ˜€', 'ðŸ‘', 'ðŸš€', 'ðŸ’¡', 'ðŸŽ¯', 'ðŸ”¥'];
                const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                messageInput.value += randomEmoji;
                messageInput.focus();
                adjustTextareaHeight();
            });
            
            // Video call button
            document.getElementById('video-call-btn').addEventListener('click', () => {
                alert('Starting video call... (WebRTC integration would be implemented here)');
            });
            
            // Audio call button
            document.getElementById('audio-call-btn').addEventListener('click', () => {
                alert('Starting audio call... (WebRTC integration would be implemented here)');
            });
            
            // Chat info button
            document.getElementById('chat-info-btn').addEventListener('click', () => {
                const activeChat = users.find(u => u.id === activeChatId);
                alert(`Chat Info:\n\nName: ${activeChat.name}\nType: ${activeChat.participants ? 'Group Chat' : 'Direct Message'}\n${activeChat.participants ? `Participants: ${activeChat.participants}` : `Status: ${activeChat.status}`}\n\nThis chat is using end-to-end encryption.`);
            });
            
            // Search functionality
            searchInput.addEventListener('input', (e) => {
                renderChatsList(e.target.value);
            });
        }

        // Update current user info
        function updateCurrentUserInfo() {
            document.getElementById('current-user-name').textContent = currentUser.name;
            document.getElementById('current-user-avatar').textContent = currentUser.avatar;
            document.getElementById('current-user-avatar').style.backgroundColor = getAvatarColor(currentUser.avatar);
            document.getElementById('current-user-status').textContent = currentUser.status.charAt(0).toUpperCase() + currentUser.status.slice(1);
        }

        // Helper functions
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function getAvatarColor(avatarText) {
            const colors = ['#007AFF', '#5856D6', '#FF2D55', '#FF9500', '#34C759', '#5AC8FA', '#FFCC00'];
            const index = avatarText.charCodeAt(0) % colors.length;
            return colors[index];
        }

        function getStatusIcon(status) {
            switch(status) {
                case 'sent': return 'âœ“';
                case 'delivered': return 'âœ“âœ“';
                case 'read': return 'âœ“âœ“';
                default: return '';
            }
        }

        function getFileType(ext) {
            const types = {
                pdf: { icon: 'file-pdf', type: 'PDF Document' },
                xlsx: { icon: 'file-excel', type: 'Excel Spreadsheet' },
                png: { icon: 'file-image', type: 'Image' },
                jpg: { icon: 'file-image', type: 'Image' },
                js: { icon: 'file-code', type: 'JavaScript File' },
                txt: { icon: 'file-alt', type: 'Text File' },
                zip: { icon: 'file-archive', type: 'Archive' }
            };
            
            return types[ext] || { icon: 'file', type: 'File' };
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }

        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = Math.min(messageInput.scrollHeight, 120) + 'px';
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>